---
title: "Homework 7 Responses"
author: "(Nicholas Bruns), Zeyi Han, Shubhi Sharma, Margaret Swift"
date: '`r Sys.Date()`'
output:
  prettydoc::html_pretty:
    theme: architect
    highlight: github
---

```{r setup, include=F}
#----------------------------------------------------------------------------
# LOADING
knitr::opts_chunk$set(echo=FALSE, eval=TRUE, cache=TRUE)
pacman::p_load(ggplot2)
source('../clarkfunctions2020.R')
Rcpp::sourceCpp('../cppFns.cpp')
# any libraries and data here

#----------------------------------------------------------------------------
# FUNCTIONS
# put functions here

```


## Exercise 1 {#q1}

* Conduct simulation experiments to determine how different values of `sig` and 
`tau` affect the behavior of `x`.  

* Determine how these same parameters affect the standard deviation of `x` and 
`y`.

* Determine how the length of the series `nt` affects the standard deviation in 
`x` and in the differenced sequence of `x`.


```{r q1}
#----------------------------------------------------------------------------
## EXERCISE 1
```
```{r}
nt   <- 200                      #no. time intervals
time <- c(1:nt)                  #sample times
nm   <- 20                       #number of missing values
wm   <- sort(sample(c(2:nt),nm)) #which are missing
sig  <- c(1,3,5,7,9)                       #process err variance
tau  <- c(10, 15, 20, 25, 30)                       #obs error variance
x    <- matrix(rep(10,nt*5), nt,5)

for (i in 1:5){  # simulate x with different sigma
for(t in 2:nt) {
  x[t,i] <- x[t-1,i] + rnorm(1,0,sqrt(sig[i]))
}}

# calculate y with different tau while sigma = 5
y <- matrix(rep(NA,nt*5), nt,5)
for( i in 1:5){   #simulate observations for x with sigma = 5
  y[,i]     <- rnorm(nt,x[,3],sqrt(tau[i])) 
}    
y[wm,] <- NA    

# 1. How do different values of sig and tau affect the behavior of x?
# plot x with different sigma
plot(time, x[,1], type = "l", ylim= c(min(x), max(x)), ylab= "x")
color = c("black", "blue", "red", "orange", "grey")
for(i in 2:5){
  lines(time, x[,i], col = color[i])}
legend("topleft", col = color, lty = c(1,1,1,1,1), legend = c("sigma = 1", "sigma = 3", "sigma = 5", "sigma = 7", "sigma = 9"))
```

Our resuljts indicate that X with higher sigma fluctuates more. Since behaviour of y does not affect the behaviour of x, change of tau does not change the behaviour of x.

```{r}
# 2. How do these same parameters affect the standard deviation of x and y?

# Culculate y from x with different sigma, while tau = 20
y2 <- matrix(rep(NA,nt*5), nt,5)
for( i in 1:5){   #simulate observations for x with sigma = 5
  y2[,i]     <- rnorm(nt,x[,i],sqrt(20)) 
}    
y2[wm,] <- NA  


require(Rfast)
x_std <- Rfast::colVars(x,std=TRUE) 
y_std_tau5 <- Rfast::colVars(na.omit(y2),std=TRUE) 
df <- as.matrix(rbind(x_std, y_std_tau5))
y_std_sig5 <- Rfast::colVars(na.omit(y),std=TRUE) 

knitr::kable(df,col.names = c("sigma = 1", "sigma = 3", "sigma = 5", "sigma = 7", "sigma = 9"))

knitr::kable(matrix(y_std_sig5,1,5),col.names = c("tau = 10", "tau = 15", "tau = 20", "tau = 25", "tau = 30"))
```
 
The results show that for both x and y, higher sigma leads to higher standard deviation. For y, increasing tau also leads to increasing standard deviation, but the magnitude of increase is smaller than the increase caused by sigma. 


```{r}
# 3. The effects of the length of time series (sig = 5)
simulate_x <- function(nt, sig){
  x    <- rep(10,nt)
  for(t in 2:nt) x[t] <- x[t-1] + rnorm(1,0,sqrt(sig))
  x
}
x200 <- simulate_x(200,5)
x400 <- simulate_x(400,5)
x600 <- simulate_x(600,5)
Xx <- cbind(x200, x400, x600)

require(dplyr)
Xx_std <- Rfast::colVars(Xx,std=TRUE) 
Xx %>% diff() %>% Rfast::colVars(Xx,std=TRUE) -> Xxdiff_std
df2 <- rbind(Xx_std,Xxdiff_std )
knitr::kable(as.matrix(df2),col.names = c("t = 200", "t = 400", "t = 600"))
```

The result shows that increasing  length of the time series does not necessary decrease the standard deviation in x, but decreases standard deviation in the differenced sequence of x. 




## Exercise 2 {#q2}

Working in your group, analyze the following model in jags.  Start by simulating 
the data set.  Then write jags code to fit the model. 

$$x_t \sim N(\alpha + \beta x_{t-1}, \sigma^2)$$

$$y_t \sim Poi( exp(x_t) )$$


```{r q2}
#----------------------------------------------------------------------------
## EXERCISE 2

```


## Exercise 3 {#q3}

* Before running any more analysis, say what you think should be the variance on 
the process and the observations.  Justify your answer.

* How much 'weight' on the priors for $\sigma^2, \tau^2$ is needed to insure that 
the posterior distribution is close to your prior distribution?

* How does the prior on $\sigma^2, \tau^2$ affect estimates of $\mathbf{\beta}$?

* Repeat the analysis with DON as the response variable and interpret results.

* What is the answer to the motivating question: Can total dissolved nitrogen 
(TDN) and dissolved organic nitrogen (DON) be explained by temperature, 
precipitation, and chlorine concentation ([Cl]), and does it differs between 
coastal streams?

```{r q3}
#----------------------------------------------------------------------------
## EXERCISE 3

```



## Appendix {#appendix}

```{r ref.label=knitr::all_labels(), echo = T, eval = F}
```


